# streamlit_app.py
import streamlit as st
import streamlit.components.v1 as components
import qrcode
import io

st.set_page_config(page_title="üîí P2P Encrypted Chat", layout="centered")
st.title("üîê P2P Encrypted Chat Launcher")

pwd = st.text_input("Set shared password:", type="password")

if pwd:
    # Generate QR code
    qr = qrcode.make(pwd)
    buf = io.BytesIO()
    qr.save(buf, format="PNG")
    st.image(buf, caption="Scan this QR to share password", width=160)

    # Embed the HTML frontend
    st.markdown("### Chat Interface")
    components.html(
        f"""
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset='UTF-8'>
          <title>P2P Chat</title>
          <style>
            body {{ background: #111; color: #fff; font-family: Arial; text-align: center; }}
            input, button {{ padding: 10px; margin: 5px; }}
          </style>
        </head>
        <body>
          <p>Password prefilled.</p>
          <input type='text' id='message' placeholder='Type message...' />
          <button onclick='send()'>Send</button>
          <div id='chat'></div>
          <script>
            const pwd = "{pwd}";
            document.body.insertAdjacentHTML("beforeend", `<p>Using password: <b>${pwd}</b></p>`);
            function send() {{
              const msg = document.getElementById('message').value;
              const div = document.getElementById('chat');
              div.innerHTML += `<div>You: ${msg}</div>`;
            }}
          </script>
        </body>
        </html>
        """,
        height=400,
    )
else:
    st.info("Enter a shared password above to launch the chat interface.")
